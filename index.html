<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–°–∞–Ω—Ç–∞ | –†–∞–±–æ—á–∏–µ –¥–Ω–∏</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      background-color: #00a7e0;
      font-family: 'Roboto', Tahoma, sans-serif;
      color: white;
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 480px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 25px;
    }
    .header h1 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 30px;
    }
    .nav_buttons {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      gap: 10px;
    }
    .nav_btn {
      flex: 1;
      background-color: rgba(255,255,255,0.2);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      text-decoration: none;
    }
    .nav_btn:hover {
      background-color: rgba(255,255,255,0.3);
    }
    .nav_btn.active {
      background-color: white;
      color: #00a7e0;
    }
    .form_card {
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      color: #333;
    }
    .input_group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      color: #555;
      margin-bottom: 8px;
      font-weight: 500;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: inherit;
      font-size: 16px;
      color: #333;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    .time_inputs {
      display: flex;
      gap: 10px;
    }
    .time_inputs input {
      flex: 1;
    }
    .radio_group {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      color: #333;
    }
    .radio_option {
      display: flex;
      align-items: center;
    }
    .radio_option input {
      width: auto;
      margin-right: 8px;
    }
    .file_upload {
      margin: 25px 0;
      position: relative;
    }
    .upload_btn {
      display: block;
      background-color: #f0f0f0;
      color: #555;
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      font-size: 16px;
      transition: all 0.3s;
      border: 2px dashed #ccc;
    }
    .upload_btn:hover {
      background-color: #e0e0e0;
      border-color: #aaa;
    }
    .file_input {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      cursor: pointer;
    }
    .file_preview {
      margin-top: 15px;
      display: none;
    }
    .file_preview.active {
      display: block;
    }
    .file_item {
      display: flex;
      align-items: center;
      background-color: #f8f8f8;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      color: #333;
    }
    .file_icon {
      margin-right: 10px;
      color: #00a7e0;
      font-size: 20px;
      line-height: 1;
    }
    .file_name {
      flex: 1;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .salary_info {
      margin-bottom: 20px;
      font-weight: 600;
      color: #333;
      font-size: 16px;
      text-align: right;
    }
    .submit_btn {
      background-color: #00a7e0;
      color: white;
      border: none;
      padding: 16px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 500;
      width: 100%;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .submit_btn:hover {
      background-color: #0088c0;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–Ω–µ–π */
    .days_list {
      display: none;
    }
    .day_card {
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      color: #333;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .day_header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-weight: 500;
    }
    .day_time {
      color: #666;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .day_comment {
      margin-bottom: 15px;
      white-space: pre-wrap;
    }
    .day_media {
      margin-top: 15px;
    }
    .media_item {
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .delete_btn {
      background-color: #ff4444;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      width: 100%;
      margin-top: 15px;
    }
    .user_filter {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .user_filter_btn {
      background-color: rgba(255,255,255,0.2);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
    }
    .user_filter_btn.active {
      background-color: white;
      color: #00a7e0;
    }
    
    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
    .stats_container {
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      color: #333;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .stats_header {
      font-weight: 700;
      margin-bottom: 15px;
      text-align: center;
      font-size: 18px;
    }
    .stats_item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .stats_label {
      font-weight: 500;
    }
    .stats_value {
      font-weight: 600;
    }
    .month_selector {
      margin-bottom: 15px;
    }
    
    @media (max-width: 480px) {
      body {
        padding: 15px;
      }
      .header h1 {
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1 id="pageTitle">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</h1>
  </div>
  
  <div class="nav_buttons">
    <a href="#" class="nav_btn" id="allDaysBtn">–í—Å–µ –¥–Ω–∏</a>
    <a href="#" class="nav_btn active" id="newDayBtn">–ù–æ–≤—ã–π –¥–µ–Ω—å</a>
    <a href="#" class="nav_btn" id="settingsBtn">–¢—Ä–µ–∫–∏</a>
  </div>
  
  <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –¥–Ω—è -->
  <div class="form_card" id="newDayForm">
    <form id="dayForm">
      <div class="radio_group">
        <div class="radio_option">
          <input type="radio" id="denis" name="user" value="–î–µ–Ω–∏—Å" checked />
          <label for="denis">–î–µ–Ω–∏—Å –ª—É—á—à–∏–π</label>
        </div>
        <div class="radio_option">
          <input type="radio" id="polina" name="user" value="–ü–æ–ª–∏–Ω–∞" />
          <label for="polina">–ü–æ–ª–∏–Ω–∞ –ø–∏–∫–º–∏</label>
        </div>
      </div>
      <div class="input_group">
        <label for="date">–î–∞—Ç–∞</label>
        <input type="date" id="date" required />
      </div>
      <div class="input_group">
        <label>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</label>
        <div class="time_inputs">
          <input type="time" id="start_time" value="08:00" required />
          <input type="time" id="end_time" value="20:00" required />
        </div>
      </div>
      <div class="input_group">
        <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–æ –¥–Ω—é</label>
        <textarea id="comment" placeholder="–ø–∏—Å–∞—Ç—å —Ç—É—Ç –µ—Å–ª–∏ —á–æ..."></textarea>
      </div>
      <div class="file_upload">
        <label class="upload_btn" for="media">+ –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ</label>
        <input type="file" id="media" class="file_input" accept="image/*,video/*" multiple />
        <div class="file_preview" id="filePreview"></div>
      </div>
      <div class="salary_info" id="salaryInfo">–¢–≤–æ–∏ –∫–æ–ø–µ–π–∫–∏: 0.00 —Ä—É–±.</div>
      <button type="submit" class="submit_btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
  </div>
  
  <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–Ω–µ–π -->
  <div class="days_list" id="daysList">
    <div class="user_filter">
      <button class="user_filter_btn active" data-user="all">–í—Å–µ</button>
      <button class="user_filter_btn" data-user="–î–µ–Ω–∏—Å">–î–µ–Ω–∏—Å –ª–µ–≥–µ–Ω–¥–∞</button>
      <button class="user_filter_btn" data-user="–ü–æ–ª–∏–Ω–∞">–ü–æ–ª–∏–Ω–∞ –Ω–∞–π–∫ –ø—Ä–æ</button>
    </div>
    
    <!-- –ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="stats_container" id="statsContainer">
      <div class="stats_header">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ <span id="currentMonthYear"></span></div>
      <div class="month_selector">
        <select id="monthSelect">
          <!-- –ú–µ—Å—è—Ü—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
        </select>
      </div>
      <div class="stats_item">
        <span class="stats_label">–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–Ω–µ–π:</span>
        <span class="stats_value" id="daysWorked">0</span>
      </div>
      <div class="stats_item">
        <span class="stats_label">–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ —á–∞—Å–æ–≤:</span>
        <span class="stats_value" id="hoursWorked">0</span>
      </div>
      <div class="stats_item">
        <span class="stats_label">–ö–æ–ø–µ–π–∫–∏:</span>
        <span class="stats_value" id="totalSalary">0.00 —Ä—É–±.</span>
      </div>
      <div class="stats_item">
        <span class="stats_label">–ö–æ–ø–µ–π–∫–∏ –≤ –¥–æ–≥–æ–≤–æ—Ä–µ:</span>
        <span class="stats_value" id="contractSalary">0.00 —Ä—É–±.</span>
      </div>
    </div>
    
    <div id="daysContainer">
      <!-- –î–Ω–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-analytics.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    deleteDoc,
    doc,
    query,
    where,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCd2Y3GhHKtibLrqipERwf5vMrCSNLFl60",
    authDomain: "santa-diary.firebaseapp.com",
    projectId: "santa-diary",
    storageBucket: "santa-diary.appspot.com",
    messagingSenderId: "193506574944",
    appId: "1:193506574944:web:23e0282d5129f2f793c7a7",
    measurementId: "G-GTPJ66CWH0"
  };
  const app = initializeApp(firebaseConfig);
  getAnalytics(app);
  const db = getFirestore(app);

  // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
  const form = document.getElementById('dayForm');
  const salaryInfo = document.getElementById('salaryInfo');
  const mediaInput = document.getElementById('media');
  const filePreview = document.getElementById('filePreview');
  const newDayForm = document.getElementById('newDayForm');
  const daysList = document.getElementById('daysList');
  const daysContainer = document.getElementById('daysContainer');
  const pageTitle = document.getElementById('pageTitle');
  const allDaysBtn = document.getElementById('allDaysBtn');
  const newDayBtn = document.getElementById('newDayBtn');
  const userFilterBtns = document.querySelectorAll('.user_filter_btn');
  const monthSelect = document.getElementById('monthSelect');
  const currentMonthYear = document.getElementById('currentMonthYear');
  const daysWorkedEl = document.getElementById('daysWorked');
  const hoursWorkedEl = document.getElementById('hoursWorked');
  const totalSalaryEl = document.getElementById('totalSalary');
  const contractSalaryEl = document.getElementById('contractSalary');
  const dateInput = document.getElementById('date');

  // –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞
  const style = document.createElement('style');
  style.textContent = `
    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .media-item {
      position: relative;
      overflow: hidden;
      border-radius: 8px;
      background: #f5f5f5;
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .media-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .media-image:hover {
      transform: scale(1.05);
    }
    .media-link {
      padding: 10px;
      color: #00a7e0;
      text-decoration: none;
      font-weight: 500;
    }
    .media-video {
      width: 100%;
      max-height: 200px;
      border-radius: 8px;
    }
  `;
  document.head.appendChild(style);

  // –£—Ç–∏–ª–∏—Ç—ã
  function pad(n) { return String(n).padStart(2, '0'); }
  
  function fmtDateInput(d) {
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  }
  
  function formatDisplayDate(s) {
    const d = new Date(s);
    return d.toLocaleDateString('ru-RU', {day: 'numeric', month: 'long', year: 'numeric'});
  }

  function initMonthSelect() {
    const months = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                   '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
    const now = new Date();
    
    for(let y = now.getFullYear()-1; y <= now.getFullYear()+1; y++) {
      for(let m = 0; m < 12; m++) {
        const opt = document.createElement('option');
        opt.value = `${y}-${m}`;
        opt.text = `${months[m]} ${y}`;
        if(y === now.getFullYear() && m === now.getMonth()) opt.selected = true;
        monthSelect.append(opt);
      }
    }
    updateCurrentMonthDisplay();
  }
  
  function updateCurrentMonthDisplay() {
    const [y, m] = monthSelect.value.split('-').map(Number);
    currentYear = y;
    currentMonth = m;
    const months = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                   '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
    currentMonthYear.textContent = `${months[m]} ${y}`;
  }

  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  dateInput.value = fmtDateInput(new Date());

  // –†–∞—Å—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã
  function updateFormSalary() {
    const start = form.start_time.value;
    const end = form.end_time.value;
    
    if(!start || !end) {
      salaryInfo.textContent = '–ö–æ–ø–µ–π–∫–∏: 0.00 —Ä—É–±.';
      return 0;
    }
    
    const startDate = new Date(`1970-01-01T${start}:00`);
    const endDate = new Date(`1970-01-01T${end}:00`);
    let hours = (endDate - startDate) / (1000 * 3600);
    if(hours < 0) hours = 0;
    
    const salary = (hours * 8.4 - 8.4).toFixed(2);
    salaryInfo.textContent = `–ó–∞—Ä–ø–ª–∞—Ç–∞: ${salary} —Ä—É–±.`;
    return parseFloat(salary);
  }

  form.start_time.addEventListener('change', updateFormSalary);
  form.end_time.addEventListener('change', updateFormSalary);

  // –ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
  mediaInput.addEventListener('change', () => {
    filePreview.innerHTML = '';
    if(mediaInput.files.length) {
      filePreview.classList.add('active');
      Array.from(mediaInput.files).forEach(file => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file_item';
        fileItem.innerHTML = `
          <span class="file_icon">üìé</span>
          <span class="file_name">${file.name}</span>
        `;
        filePreview.append(fileItem);
      });
    } else {
      filePreview.classList.remove('active');
    }
  });

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ ImgBB
  async function uploadFileToImgBB(file) {
    const formData = new FormData();
    formData.append('image', file);
    
    try {
      const response = await fetch('https://api.imgbb.com/1/upload?key=f615d978ca8fd405d2e746aefcba1637', {
        method: 'POST',
        body: formData
      });
      
      const data = await response.json();
      
      if(data.status !== 200) {
        throw new Error(data.error?.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
      }
      
      return data.data.url;
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', error);
      throw error;
    }
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  form.addEventListener('submit', async e => {
    e.preventDefault();

    const user = form.querySelector('input[name="user"]:checked').value;
    const date = form.date.value;
    const startTime = form.start_time.value;
    const endTime = form.end_time.value;
    const comment = form.comment.value;
    const salary = updateFormSalary();

    try {
      // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
      let mediaLinks = [];
      if(mediaInput.files.length > 0) {
        for(const file of mediaInput.files) {
          const link = await uploadFileToImgBB(file);
          mediaLinks.push(link);
        }
      }

      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Firestore
      await addDoc(collection(db, 'workingDays'), {
        user,
        date,
        startTime,
        endTime,
        comment,
        salary,
        mediaFiles: mediaLinks,
        timestamp: serverTimestamp()
      });

      alert('–°–≤–µ—Ç–ª–∞–Ω–∞ —Ç–æ–±–æ–π –≥–æ—Ä–¥–∏—Ç—Å—è!!!');
      form.reset();
      filePreview.innerHTML = '';
      filePreview.classList.remove('active');
      salaryInfo.textContent = '–ó–∞—Ä–ø–ª–∞—Ç–∞: 0.00 —Ä—É–±.';
      dateInput.value = fmtDateInput(new Date());
    } catch (error) {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + error.message);
    }
  });

  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –º–µ–¥–∏–∞ –ø–æ URL
  function getMediaType(url) {
    if(/\.(jpg|jpeg|png|gif|webp|bmp)$/i.test(url)) return 'image';
    if(/\.(mp4|webm|ogg|mov)$/i.test(url)) return 'video';
    return 'other';
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–Ω–µ–π
  async function loadDays() {
    daysContainer.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
    
    const startDate = fmtDateInput(new Date(currentYear, currentMonth, 1));
    const endDate = fmtDateInput(new Date(currentYear, currentMonth + 1, 0));
    
    const q = query(
      collection(db, 'workingDays'),
      where('date', '>=', startDate),
      where('date', '<=', endDate)
    );
    
    const snapshot = await getDocs(q);
    const days = [];
    snapshot.forEach(doc => days.push({ id: doc.id, ...doc.data() }));
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const filteredDays = currentUser === 'all' 
      ? days 
      : days.filter(day => day.user === currentUser);
    
    if(filteredDays.length === 0) {
      daysContainer.innerHTML = '<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥</p>';
      updateStats([]);
      return;
    }
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    filteredDays.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    daysContainer.innerHTML = '';
    
    filteredDays.forEach(day => {
      let mediaHTML = '';
      if(day.mediaFiles?.length > 0) {
        mediaHTML = `
          <div class="day_media">
            <p>–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</p>
            <div class="media-grid">
              ${day.mediaFiles.map(url => {
                const type = getMediaType(url);
                
                if(type === 'image') {
                  return `
                    <div class="media-item">
                      <img src="${url}" alt="–§–æ—Ç–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è" class="media-image" loading="lazy">
                    </div>
                  `;
                } else if(type === 'video') {
                  return `
                    <div class="media-item">
                      <video controls class="media-video">
                        <source src="${url}" type="video/mp4">
                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                      </video>
                    </div>
                  `;
                } else {
                  return `
                    <div class="media-item">
                      <a href="${url}" target="_blank" class="media-link">üìÅ –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</a>
                    </div>
                  `;
                }
              }).join('')}
            </div>
          </div>
        `;
      }
      
      const dayCard = document.createElement('div');
      dayCard.className = 'day_card';
      dayCard.innerHTML = `
        <div class="day_header">
          <span>${day.user}</span>
          <span>${formatDisplayDate(day.date)}</span>
        </div>
        <div class="day_time">
          –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${day.startTime} - ${day.endTime}
        </div>
        <div class="day_comment">
          ${day.comment || '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'}
        </div>
        ${mediaHTML}
        <div class="salary_info">
          –ó–∞—Ä–ø–ª–∞—Ç–∞: ${day.salary || '0.00'} —Ä—É–±.
        </div>
        <button class="delete_btn" data-id="${day.id}">–£–¥–∞–ª–∏—Ç—å</button>
      `;
      
      daysContainer.appendChild(dayCard);
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
    document.querySelectorAll('.delete_btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        if(confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª—è–µ–º?')) {
          try {
            await deleteDoc(doc(db, 'workingDays', btn.dataset.id));
            btn.parentElement.remove();
            updateStats();
          } catch (error) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message);
          }
        }
      });
    });
    
    updateStats(filteredDays);
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  function updateStats(days = []) {
    let totalHours = 0;
    let totalSalary = 0;
    
    days.forEach(day => {
      const start = new Date(`1970-01-01T${day.startTime}:00`);
      const end = new Date(`1970-01-01T${day.endTime}:00`);
      let hours = (end - start) / (1000 * 3600);
      if(hours < 0) hours = 0;
      
      totalHours += hours;
      totalSalary += parseFloat(day.salary || 0);
    });
    
    daysWorkedEl.textContent = days.length;
    hoursWorkedEl.textContent = totalHours.toFixed(1);
    totalSalaryEl.textContent = `${totalSalary.toFixed(2)} —Ä—É–±.`;
    contractSalaryEl.textContent = `${(totalSalary / 0.87).toFixed(2)} —Ä—É–±.`;
  }

  // –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –º–µ—Å—è—Ü
  let currentUser = 'all';
  let currentYear = new Date().getFullYear();
  let currentMonth = new Date().getMonth();

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  allDaysBtn.addEventListener('click', e => {
    e.preventDefault();
    newDayForm.style.display = 'none';
    daysList.style.display = 'block';
    pageTitle.textContent = '–í—Å–µ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏';
    updateActiveNavBtn(allDaysBtn);
    loadDays();
  });

  newDayBtn.addEventListener('click', e => {
    e.preventDefault();
    newDayForm.style.display = 'block';
    daysList.style.display = 'none';
    pageTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å';
    updateActiveNavBtn(newDayBtn);
  });

  function updateActiveNavBtn(activeBtn) {
    document.querySelectorAll('.nav_btn').forEach(btn => {
      btn.classList.remove('active');
    });
    activeBtn.classList.add('active');
  }

  

  userFilterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      userFilterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentUser = btn.dataset.user;
      loadDays();
    });
  });

  monthSelect.addEventListener('change', () => {
    updateCurrentMonthDisplay();
    loadDays();
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  initMonthSelect();
  loadDays();

  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–¢—Ä–µ–∫–∏"
  const settingsBtn = document.getElementById('settingsBtn');
  const tracksContainer = document.createElement('div');
  tracksContainer.id = 'tracksContainer';
  tracksContainer.className = 'form_card';
  tracksContainer.style.display = 'none';
  document.querySelector('.container').appendChild(tracksContainer);

  settingsBtn.addEventListener('click', (e) => {
    e.preventDefault();
    newDayForm.style.display = 'none';
    daysList.style.display = 'none';
    tracksContainer.style.display = 'block';
    pageTitle.textContent = '–¢—Ä–µ–∫–∏ –∏ –≥–∞–¥–∞–Ω–∏—è';
    updateActiveNavBtn(settingsBtn);
    renderTracksContent();
  });

  function renderTracksContent() {
    tracksContainer.innerHTML = `
      <div class="tracks-section">
        <h2>–¢—Ä–µ–∫–∏</h2>
        <div class="tracks-grid" id="tracksGrid">
          <!-- –¢—Ä–µ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
        </div>
      </div>
      
      <div class="divination-section">
        <h2>–ì–ê–î–ê–ù–ò–Ø</h2>
        
        <div class="divination-block">
          <h3>–í–∞–π–± –°–≤–µ—Ç–ª–∞–Ω—ã —Å–µ–≥–æ–¥–Ω—è</h3>
          <button id="vibeBtn" class="divination-btn">–£–∑–Ω–∞—Ç—å –≤–∞–π–±</button>
          <div id="vibeResult" class="divination-result"></div>
        </div>
        
        <div class="divination-block">
          <h3>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –¥–µ–Ω—å</h3>
          <button id="forecastBtn" class="divination-btn">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑</button>
          <div id="forecastResult" class="divination-result"></div>
        </div>
      </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–µ–∫–∏
    const tracksGrid = document.getElementById('tracksGrid');
    const tracks = [
      { id: 1, name: "27 –º—ã —à–∞–≥–Ω—É–ª–∏ –≤ –∑–∞–ª –≤–µ—Å–Ω—ã", file: "27.mp3" },
      { id: 2, name: "–Ω–µ—Ç —Å–ª–æ–≤", file: "net.mp3" },
      { id: 3, name: "–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ç—Ä–µ–∫–∞ —Ö–æ—á–µ—Ç—Å—è –ª–µ—á—å –Ω–∞ –±–∞–Ω–∞–Ω–∫–µ –∏ –∑–∞–±—ã—Ç—å –æ–±–æ –≤—Å—ë–º", file: "gud.mp3" },
      { id: 4, name: "–¢–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω —ç—Ç–æ—Ç –º–∏—Ä", file: "mir.mp3" },
      { id: 5, name: "MILKSHAKE", file: "milk.mp3" },
      { id: 6, name: "–õ–µ—Ç–æ –≤ –°–∞–Ω—Ç–µ", file: "leto.mp3" },
      { id: 7, name: "–ó–∏–º–∞ –≤ –°–∞–Ω—Ç–µ", file: "zima.mp3" },
      { id: 8, name: "GIANT", file: "giant.mp3" },
      { id: 9, name: "–ê –ø–∞–ø–µ —á—Ç–æ?..", file: "pekar.mp3" },
    ];

    tracks.forEach(track => {
      const trackElement = document.createElement('div');
      trackElement.className = 'track-item';
      trackElement.innerHTML = `
        <div class="track-name">${track.name}</div>
        <audio controls class="track-player">
          <source src="${track.file}" type="audio/mp3">
          –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
        </audio>
      `;
      tracksGrid.appendChild(trackElement);
    });

    // –í–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –≥–∞–¥–∞–Ω–∏–π
    const vibes = [
      "–°–µ–≥–æ–¥–Ω—è –°–≤–µ—Ç–ª–∞–Ω–∞ –≤ –æ—Ç–ª–∏—á–Ω–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏!",
      "–°–≤–µ—Ç–ª–∞–Ω–∞ —Å–ª–µ–≥–∫–∞ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∞, –ª—É—á—à–µ –Ω–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å",
      "–í–∞–π–± –°–≤–µ—Ç–ª–∞–Ω—ã —Å–µ–≥–æ–¥–Ω—è - –∑–∞–≥–∞–¥–∫–∞. –ù–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç, —á—Ç–æ —É –Ω–µ–µ –Ω–∞ —É–º–µ",
      "–°–≤–µ—Ç–ª–∞–Ω–∞ c–µ–≥–æ–¥–Ω—è –∏–∑–ª—É—á–∞–µ—Ç –ø–æ–∑–∏—Ç–∏–≤ –∏ –∫—Ä–µ–∞—Ç–∏–≤",
      "–°–µ–≥–æ–¥–Ω—è –°–≤–µ—Ç–ª–∞–Ω–∞ –≥–æ—Ç–æ–≤–∞ —Ä–∞—Å–∫—Ä–æ–º—Å–∞—Ç—å –Ω–∞ –∫—É—Å–∫–∏ –ª—é–±–æ–≥–æ",
      "–í–∞–π–± –°–≤–µ—Ç–ª–∞–Ω—ã —Å–µ–≥–æ–¥–Ω—è - –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–π –∏ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–Ω—ã–π, –Ω–∞ –∑–∞–ª –≤—ã–π–¥–µ—Ç –±—É–∫–≤–∞–ª—å–Ω–æ –ø–∞—Ä—É —Ä–∞–∑",
      "–°–≤–µ—Ç–ª–∞–Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ–º–Ω–æ–≥–æ –Ω–æ—Å—Ç–∞–ª—å–≥–∏—Ä—É–µ—Ç –æ –ø—Ä–æ—à–ª–æ–º",
      "–°–µ–≥–æ–¥–Ω—è —É –°–≤–µ—Ç–ª–∞–Ω—ã –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ!",
      "–ù–ï –ü–û–ü–ê–î–ê–ô–°–Ø –ù–ê –ì–õ–ê–ó–ê –°–í–ï–¢–õ–ê–ù–ï –°–ï–ì–û–î–ù–Ø –í–û–û–ë–©–ï –ù–ò–ö–ê–ö –ò –≠–¢–û –ù–ï –®–£–¢–ö–ê. –ï—ë –≤–∑–±–µ—Å–∏—Ç –∫—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–π –Ω–æ –ø–µ—Ä–µ–ø–∞–¥–µ—Ç —Ç–µ–±–µ, –≤–æ–∑–º–æ–∂–Ω–æ —Å—Ç—Ä–∞–Ω–Ω—ã–º –∑–∞–¥–∞–Ω–∏–µ–º",
      "–°–µ–≥–æ–¥–Ω—è —Ç—ã –±—É–¥–µ—à—å –≤—Å—Ç—Ä–µ—á–∞—Ç—å —Å–≤–µ—Ç–ª–∞–Ω—É —á–∞—â–µ —á–µ–º –æ–±—ã—á–Ω–æ",
      "–°–µ–≥–æ–¥–Ω—è –≤ –°–≤–µ—Ç–ª–∞–Ω–µ —á—Ç–æ —Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è, —Ç–æ –ª–∏ –æ–¥–µ–∂–¥–∞, —Ç–æ –ª–∏ –ø–∞—Ä—Ñ—é–º, —Ç–æ –ª–∏ —á—Ç–æ-—Ç–æ –µ—â—ë",
      "–ñ–¥–∏—Ç–µ –æ—Ç –°–≤–µ—Ç–ª–∞–Ω—ã –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å–µ–≥–æ–¥–Ω—è",
      "–î–µ–≤–æ—á–∫–∞ –∑–∞–≥–∞–¥–∫–∞",
      "–°–µ–≥–æ–¥–Ω—è –æ–Ω–∞ —Ç–∏—Ä–∞–Ω",
      "–ï—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∫–∞–∂–µ—Ç—Å—è –Ω–∞ –≤–∞—Å —Å–µ–≥–æ–¥–Ω—è",
      "–ë—É–¥–µ—Ç –Ω–∞ –∫–æ–≥–æ-—Ç–æ –∫—Ä–∏—á–∞—Ç—å, –Ω–æ –Ω–µ –Ω–∞ –í–∞—Å",
      "–ü—Ä–∏–¥—ë—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –±—É–∫–≤–∞–ª—å–Ω–æ –Ω–∞ –ø–∞—Ä—É —á–∞—Å–æ–≤"
    ];

    const forecasts = [
      "–°–µ–≥–æ–¥–Ω—è –≤–∞—Å –∂–¥–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞",
      "–î–µ–Ω—å –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–∏—á–µ–≥–æ–Ω–µ–¥–µ–ª–∞–Ω–∏—è",
      "–í–µ—Ä–æ—è—Ç–Ω—ã –Ω–µ–±–æ–ª—å—à–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏",
      "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É–±—ã—Ç–∫–∏",
      "–õ—É—á—à–∏–π –¥–µ–Ω—å —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ",
      "–û–∂–∏–¥–∞–π—Ç–µ –ø—Ä–∏—è—Ç–Ω–æ–≥–æ —Å—é—Ä–ø—Ä–∏–∑–∞ –∫ –∫–æ–Ω—Ü—É –¥–Ω—è",
      "–û–∂–∏–¥–∞–π—Ç–µ –£–ñ–ê–°–ù–û–ì–û —Å—é—Ä–ø—Ä–∏–∑–∞ –∫ –∫–æ–Ω—Ü—É –¥–Ω—è",
      "–°–µ–≥–æ–¥–Ω—è —Å—Ç–æ–∏—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —Ä—É—Ç–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö",
      "–î–µ–Ω—å –æ–±–µ—â–∞–µ—Ç –±—ã—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–º",
      "–°–µ–≥–æ–¥–Ω—è –≤–∞—Å –∂–¥–µ—Ç –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ",
      "–û–∂–∏–¥–∞–π—Ç–µ –ø–ª–æ—Ö–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π",
      "–†–æ–≤–Ω–æ –≤ 09:52 –Ω—É–∂–Ω–æ –±—ã—Ç—å –≤ –æ–¥–∏–Ω–æ—á–Ω–æ–º —Ç—É–∞–ª–µ—Ç–µ. –¢–∞–º –≤—ã –≤—Å—ë –∏ —É–∑–Ω–∞–µ—Ç–µ",
      "–î–µ–Ω—å –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤—Ä–∞—Ç–Ω—ã–º",
      "–û–∂–∏–¥–∞–π—Ç–µ —Å—é—Ä–ø—Ä–∏–∑ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è",
      "–ß—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ –±—É–¥–µ—Ç —Å –≤–µ—á–µ—Ä–Ω–∏–º —Ç—Ä–∞–º–≤–∞–µ–º",
      "–û—Å—Ç–µ—Ä–µ–≥–∞–π—Ç–µ—Å—å —á–µ–ª–æ–≤–µ–∫–∞ —Å –∏–º–µ–Ω–µ–º –õ–µ–Ω–∞",
      "–û—Å—Ç–µ—Ä–µ–≥–∞–π—Ç–µ—Å—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –º—É–∂—Å–∫–æ–≥–æ –ø–æ–ª–∞, –≤ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≥—Ä—É–∑—á–∏–∫–æ–≤"
    ];

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≥–∞–¥–∞–Ω–∏–π
    document.getElementById('vibeBtn').addEventListener('click', () => {
      const randomVibe = vibes[Math.floor(Math.random() * vibes.length)];
      document.getElementById('vibeResult').innerHTML = `
        <div class="result-text">${randomVibe}</div>
        <div class="result-emoji">${getRandomEmoji()}</div>
      `;
    });

    document.getElementById('forecastBtn').addEventListener('click', () => {
      const randomForecast = forecasts[Math.floor(Math.random() * forecasts.length)];
      document.getElementById('forecastResult').innerHTML = `
        <div class="result-text">${randomForecast}</div>
        <div class="result-emoji">üîÆ</div>
      `;
    });
  }

  function getRandomEmoji() {
    const emojis = ["‚ú®", "üåü", "üí´", "‚ö°", "üåà", "üéØ", "üßø", "üîÆ", "üé≤", "üíé"];
    return emojis[Math.floor(Math.random() * emojis.length)];
  }

  // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
  const tracksStyles = document.createElement('style');
  tracksStyles.textContent = `
    .tracks-section, .divination-section {
      margin-bottom: 30px;
    }
    
    .tracks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .track-item {
      background: #f8f8f8;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .track-name {
      font-weight: 500;
      margin-bottom: 10px;
      color: #333;
    }
    
    .track-player {
      width: 100%;
    }
    
    .divination-block {
      background: #f8f8f8;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .divination-btn {
      background-color: #00a7e0;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.3s;
    }
    
    .divination-btn:hover {
      background-color: #0088c0;
    }
    
    .divination-result {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      text-align: center;
      min-height: 60px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .result-text {
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
    }
    
    .result-emoji {
      font-size: 24px;
    }
  `;
  document.head.appendChild(tracksStyles);
  
</script>


</body>
</html>
